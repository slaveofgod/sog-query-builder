!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.sogqb=t()}(this,function(){!function(){for(var e={},t=["Array","Object","Function","Date","RegExp","Float32Array"],n=0;n<t.length;n++)e["[object "+t[n]+"]"]=t[n].toLowerCase()}();var a={version:"0.0.1",revision:"0803c82",config:{stateElementTypes:["expression","conjunction"],expressionOperators:[{key:"equal",label:"Equal"},{key:"not_equal",label:"Not Equal"},{key:"more",label:"More"},{key:"more_or_equal",label:"More or Equal"},{key:"less",label:"Less"},{key:"less_or_equal",label:"less_or_equal"},{key:"like",label:"Like"}],conjunctionOperators:[{key:"or",label:"Or"},{key:"and",label:"And"}]},common:{},themes:{},registerTheme:function(t){var e=new[t][0]({},{},!0),n=e.alias;if(void 0===n)throw new Error('The theme has to have "alias" property');if("BaseTheme"!==e.base)throw new Error('The theme has to extend "sogqb.BaseTheme" abstract class');if(void 0===e.__draw)throw new Error('The theme has to implement "__draw" method');if(!1===sogv.isType("string",n)&&!1===sogv.isType("array",n))throw new Error('The alias must be type of "string" or "array", "'+sogv.getType(n)+'" given');"string"==typeof n&&(n=[n]),n.forEach(function(e){void 0===a.themes[t]&&(a.themes[e]=t)})},makeTheme:function(e,t,n,i){if(void 0===a.themes[e])throw new Error('Theme with alias "'+e+'" is not registered.');return new a.themes[e](t,n,i)},makeScheme:function(e){return new a.Scheme(e)},makeState:function(e,t){return new a.State(e,t)},isValidException:function(e,t,n){var i=sogv.isValidWithErrorMessage(t,n);if(null!==i)throw new Error(e+": "+i);return!0}};function e(e,t,n){this.__options=e||{},this.__internal=!0===n,(this.__skipDrawing=!1)===this.__internal&&this.__validateOptions(t),this.name="BaseTheme",this.base="BaseTheme"}function t(e){this.__scheme=e||null,this.__validate(),this.name="Scheme"}function n(e,t){this.__state=e||null,this.__scheme=t||null,null!==this.__state&&(this.__validate(),this.__validateFields()),this.name="State"}function i(e,t,n,i,r){var s=this;this.__container=e||null,this.__entity=t||null,this.__scheme=n||null,this.__state=i||null,this.__theme=r||"material",a.isValidException("Container",this.__container,"required|string|length:5,255"),a.isValidException("Entity",this.__entity,"required|string|length:2,50"),this.setScheme(this.__scheme),this.setTheme(this.__theme),this.setState(this.__state,this.__scheme),this.name="Application",window.addEventListener("resize",function(){s.draw()})}function r(e,t,n){a.BaseTheme.call(this,e,{container:t.container||"required|string|length:5,255"},n),this.container=this.__options.container,this.name="MaterialTheme"}return"undefined"!=typeof exports&&(exports.sogqb=a),Object.assign(a,(Object.assign(e.prototype,{appendChild:function(e,t){var n=document.getElementById(this.container),i=this.__buildElement(e,t);n.appendChild(i)},destroy:function(){document.getElementById(this.container).innerHTML=""},draw:function(){this.__beforeDraw(),!1===this.__skipDrawing&&(console.info('Drawing this container with the id "'+this.container+'" ...'),this.__draw(),this.__buildStyleElement(),this.__buildContainerElement(),this.__prettify()),this.__afterDraw()},__draw:function(){throw new Error('The theme has to implement "__draw" method')},__beforeDraw:function(){null===document.getElementById(this.container)&&(this.__skipDrawing=!0,console.info('This container with the id "'+this.container+'" does not exist.'))},__afterDraw:function(){},__validateOptions:function(e){if(null!=e)for(var t in e)e.hasOwnProperty(t)&&a.isValidException("[option: "+t+"]",this.__options[t],e[t])},__prepareCssStyles:function(e){var t={container:this.container};for(var n in t)t.hasOwnProperty(n)&&(e=e.replace(new RegExp("%%"+n+"%%","gm"),t[n]));return e},__buildStyleElement:function(){var e=document.getElementById(this.container),t=document.createElement("style");t.innerHTML=this.__prepareCssStyles(this.cssStyles),e.appendChild(t)},__buildContainerElement:function(){var e=document.getElementById(this.container),t=this.__buildElement("query"),n=this.__buildElement("search"),i=this.__buildElement("clear");e.appendChild(t),e.appendChild(n),e.appendChild(i)},__prettify:function(){var e=document.getElementById(this.container),t=e.clientWidth;e.childNodes.forEach(function(e){!1===e.classList.contains("query")&&(t-=parseInt(e.clientWidth+3))}),e.querySelector(".query").style.width=t+"px"},__buildElement:function(e,t){var n=document.createElement("template"),i="";switch(e){case"query":i=this.queryButton.trim();break;case"search":i=this.searchButton.trim();break;case"clear":i=this.clearButton.trim();break;case"field":i=this.fieldButton.trim();break;case"expressionOperator":i=this.expressionOperatorButton.trim();break;case"fieldValue":i=this.fieldValueButton.trim();break;case"conjunctionOperator":i=this.conjunctionOperatorButton.trim()}n.innerHTML=this.__prepareElement(i,t);var r=n.content.firstChild;switch(e){case"search":case"clear":r.className+=" "+this.cssControlClasses;break;case"field":case"expressionOperator":case"fieldValue":case"conjunctionOperator":r.className+=" "+this.cssQueryClasses}switch(e){case"query":r.classList.add("query-button");break;case"search":r.classList.add("search-button");break;case"clear":r.classList.add("clear-button");break;case"field":r.classList.add("field-button");break;case"expressionOperator":r.classList.add("expression-operator-button");break;case"fieldValue":r.classList.add("field-value-button");break;case"conjunctionOperator":r.classList.add("conjunction-operator-button")}return r},__prepareElement:function(e,t){for(var n in t=t||{})t.hasOwnProperty(n)&&(e=e.replace("%%"+n+"%%",t[n]));return e}}),{BaseTheme:e})),Object.assign(a,(t.prototype.constructor=t,Object.defineProperties(t.prototype,{scheme:{get:function(){return this.__scheme}}}),Object.assign(t.prototype,{getEntity:function(e){for(var t=null,n=0;n<this.__scheme.length;n++)if(e===this.__scheme[n].entity){t=this.__scheme[n];break}return t},exist:function(e){e=e.split(".");var t=this.getEntity(e[0]);if(null===t)return!1;for(var n=0;n<t.columns.length;n++)if(e[1]===t.columns[n].name)return!0;return!1},getEntityFields:function(e){var t=this.getEntity(e),n=[];if(null===t)return[];for(var i=0;i<t.columns.length;i++)n.push({name:t.columns[i].name,title:t.columns[i].title});return n},getEntityFieldLabel:function(e){e=e.split(".");for(var t=this.getEntity(e[0]),n=e[1],i=0;i<t.columns.length;i++)if(e[1]===t.columns[i].name){n=t.columns[i].title;break}return n},getEntityFieldFormattedValue:function(e,t){e=e.split(".");for(var n=this.getEntity(e[0]),i=t,r=0;r<n.columns.length;r++)if(e[1]===n.columns[r].name){switch(n.columns[r].type){case"entity":for(var s=0;s<n.columns[r].data.length;s++)if(t===n.columns[r].data[s].id){i=n.columns[r].data[s].label;break}}break}return i},__validate:function(){a.isValidException("Scheme",this.__scheme,"required|array|count:1,100");for(var e=0;e<this.__scheme.length;e++)this.__validateEntity(this.__scheme[e].entity),this.__validateColumns(this.__scheme[e].columns);return!0},__validateEntity:function(e){return a.isValidException("Entity",e,"required|string|alpha-dash|length:2,50"),!0},__validateColumns:function(e){return a.isValidException("Columns",e,"required|array|between:1,1000"),e.forEach(function(e){var t=new sogv.Application({lang:"en"}),n={name:e.name,title:e.title,type:e.type,data:e.data},i=t.make(n,{name:"required|string|alpha-dash|length:2,50",title:"required|string|print|length:2,100",type:"required|in:email;integer;numeric;string;date;entity",data:"array"});if(!1===i.isValid())for(var r in n)if(n.hasOwnProperty(r)&&!1===i.get(r).isValid())throw new Error("Column '"+r+"' = '"+n[r]+"': "+i.get(r).errors().first())}),!0}}),{Scheme:t})),Object.assign(a,(n.prototype.constructor=n,Object.defineProperties(n.prototype,{state:{get:function(){return this.__state}}}),Object.assign(n.prototype,{draw:function(e){e.fieldButton,e.fieldValueButton,e.expressionOperatorButton,e.conjunctionOperatorButton;for(var t=0;t<this.__state.length;t++)switch(this.__state[t].type){case"expression":this.__state[t].field.split("."),e.appendChild("field",{value:this.__state[t].field,label:this.__scheme.getEntityFieldLabel(this.__state[t].field)}),e.appendChild("expressionOperator",{label:this.__state[t].operator}),e.appendChild("fieldValue",{value:this.__state[t].value,label:this.__scheme.getEntityFieldFormattedValue(this.__state[t].field,this.__state[t].value)});break;case"conjunction":e.appendChild("conjunctionOperator",{label:this.__state[t].operator})}},__validate:function(){a.isValidException("State",this.__state,"required|array|count:1,100");for(var e=0;e<this.__state.length;e++){a.isValidException("State > Type",this.__state[e].type,"required|alnum|in:"+a.config.stateElementTypes.join(";"));var t=new sogv.Application({lang:"en"}),n={},i={};switch(this.__state[e].type){case"expression":n={field:this.__state[e].field,value:this.__state[e].value,operator:this.__state[e].operator},i={field:"required|regex:^[a-zA-Z0-9_-]+.[a-zA-Z0-9_-]+$",value:"required|scalar",operator:"required|alnum|in:"+a.config.expressionOperators.map(function(e){return e.key}).join(";")};break;case"conjunction":n={operator:this.__state[e].operator},i={operator:"required|alnum|in:"+a.config.conjunctionOperators.map(function(e){return e.key}).join(";")}}var r=t.make(n,i);if(!1===r.isValid())for(var s in n)if(n.hasOwnProperty(s)&&!1===r.get(s).isValid())throw new Error(sogh.camelCase(this.__state[e].type)+" '"+s+"' = '"+n[s]+"': "+r.get(s).errors().first())}return!0},__validateFields:function(){for(var e=0;e<this.__state.length;e++)if("expression"===this.__state[e].type){var t=this.__state[e].field.split(".");if(!1===this.__scheme.exist(this.__state[e].field))throw new Error('Model "'+t[0]+'" or field "'+t[1]+'" for model "'+t[0]+'" does not exist.')}return!0}}),{State:n})),a.QueryBuilderFactory={create:function(e,t,n){return new function(e,t,n){this.__scheme=e,this.__theme=t,this.__state=n,this.draw=function(){this.__theme.destroy(),this.__state.draw(t),this.__theme.draw()}}(e,t,n)}},Object.assign(a,(i.prototype.constructor=i,Object.defineProperties(i.prototype,{container:{get:function(){return this.__container}},entity:{get:function(){return this.__entity}},scheme:{get:function(){return this.__scheme}},state:{get:function(){return this.__state}},theme:{get:function(){return this.__theme}}}),Object.assign(i.prototype,{setScheme:function(e){this.__scheme=a.makeScheme(e)},setState:function(e,t){void 0!==e&&(t=this.__state),null!==typeof t&&(t=this.__scheme),this.__state=a.makeState(e,t)},setTheme:function(e){this.__theme=a.makeTheme(e,{container:this.container},{})},draw:function(){a.QueryBuilderFactory.create(this.__scheme,this.__theme,this.__state).draw()}}),{Application:i})),Object.assign(a,((r.prototype=Object.create(a.BaseTheme.prototype)).constructor=r,Object.defineProperty(r.prototype,"alias",{get:function(){return["material"]}}),Object.defineProperties(r.prototype,{cssStyles:{get:function(){return"#%%container%%{height:36px;border:1px solid #5E5E5E;font-size:16px;}#%%container%% .query{height:34px;float:left;width:10px;padding:4px 0 4px 6px;}#%%container%% button.float-left{margin:3px 0 3px 3px;float:left;}#%%container%% button.float-right{margin:3px 3px 3px 0;float:right;}#%%container%% .btn-group-sm > .btn, .btn-super-sm{padding:3px 10px;font-size:14px;line-height:1.5;border-radius:2px;text-transform:none;}#%%container%% [contentEditable=true]:empty:not(:focus):before{content:attr(data-text);opacity:.5;}"}},cssControlClasses:{get:function(){return"btn btn-default waves-effect btn-super-sm float-right"}},cssQueryClasses:{get:function(){return"btn btn-default btn-icon-text waves-effect btn-super-sm float-left"}},queryButton:{get:function(){return'<div class="query" contentEditable=true data-text="Searching Filter"></div>'}},searchButton:{get:function(){return'<button class="search"><i class="zmdi zmdi-search"></i></button>'}},clearButton:{get:function(){return'<button class="clear"><i class="zmdi zmdi-close"></i></button>'}},fieldButton:{get:function(){return'<button class = "bgm-lightgreen" data-value="%%value%%">%%label%%</button>'}},expressionOperatorButton:{get:function(){return'<button class="bgm-lightblue" data-value="%%value%%">%%label%%</button>'}},fieldValueButton:{get:function(){return'<button class="bgm-purple" data-value="%%value%%">%%label%%</button>'}},conjunctionOperatorButton:{get:function(){return'<button class="bgm-black" data-value="%%value%%">%%label%%</button>'}}}),Object.assign(r.prototype,{__draw:function(){}}),{MaterialTheme:r})),a.registerTheme(a.MaterialTheme),a});